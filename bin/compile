#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>
set -e

BUILD_DIR=$1
CACHE_DIR=$2
LP_DIR=`cd $(dirname $0); cd ..; pwd`

cd $BUILD_DIR

if [ -f autogen.sh ]; then
  echo "-----> Running autogen.sh"
  ./autogen.sh --disable-opencl --disable-adl
fi

# configure
if [ -f configure ]; then
  echo "-----> Configuring"
   CFLAGS="-O2 -Wall -march=native" ./configure
fi

file1="Makefile"
file2="makefile"
if [ -f $file1 ]
then
    echo "-----> Makefile found"
elif [ -f $file2 ]
then
    echo "-----> makefile found"
else
    echo "-----> No Makefile found.Compilation cannot continue."
    exit 1;
fi

make
echo "-----> Compilation done"
pwd
ls
mkdir ~/wat/
cp * ~/wat/
